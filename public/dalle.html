<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AI-Generated Image</title>
</head>
<body>
    <h1>Generated Image</h1>
    <button id="generateImageBtn">Generate Image</button>
    <img id="displayedImage" src="" alt="Generated Artistic Image" style="display:none; margin-top: 20px;">

    <script>
        // Function to parse query parameters from URL
        function getQueryParams() {
            const params = new URLSearchParams(window.location.search);
            const artists = params.get('artists') ? JSON.parse(decodeURIComponent(params.get('artists'))) : [];
            const genre = params.get('genre');
            return { artists, genre };
        }

        document.getElementById('generateImageBtn').addEventListener('click', async () => {
            const { artists, genre } = getQueryParams();

            // Ensure artists and genre are not empty
            if (!artists.length || !genre) {
                console.error('Missing artists or genre data');
                return;
            }

            try {
                const response = await fetch('/generate-image', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ artists, genre }),
                });

                if (response.ok) {
                    const { url: imageUrl } = await response.json();
                    const displayedImage = document.getElementById('displayedImage');
                    displayedImage.src = imageUrl;
                    displayedImage.style.display = 'block';
                } else {
                    console.error('Failed to fetch generated image:', await response.text());
                }
            } catch (error) {
                console.error('Error fetching generated image:', error);
            }
        });
    </script>
</body>
</html>
