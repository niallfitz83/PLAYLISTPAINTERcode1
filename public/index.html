<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Playlist Painter</title>
</head>
<body>
    <div id="login" class="container my-auto text-center">
        <h1 class="mb-1">Playlist Painter</h1>
        <h3 class="mb-5"><em>Giving your playlists their true identity</em></h3>
        <a class="btn btn-primary btn-xl js-scroll-trigger" role="button" href="/login">Log in with Spotify</a>
        <div class="overlay"></div>
    </div>

    <div id="logged-in" style="display: none;">
        <h1>Logged in with Spotify!</h1>
        <button id="fetch-playlists">Fetch Playlists</button>
        <div id="playlist-container"></div>
    </div>

    <script src="authorization.js"></script>
    <script>
        function getHashParams() {
            let hashParams = {};
            let e, r = /([^&;=]+)=?([^&;]*)/g, 
                q = window.location.hash.substring(1);
            while (e = r.exec(q)) {
                hashParams[e[1]] = decodeURIComponent(e[2]);
            }
            return hashParams;
        }

        let params = getHashParams();

        let access_token = params.access_token;
        let refresh_token = params.refresh_token;
        let error = params.error;

        if (error) {
            alert('There was an error during the authentication');
        } else {
            if (access_token) {
                document.getElementById('login').style.display = 'none';
                document.getElementById('logged-in').style.display = 'block';
            } else {
                document.getElementById('login').style.display = 'block';
                document.getElementById('logged-in').style.display = 'none';
            }
        }

        document.getElementById('fetch-playlists').addEventListener('click', async function () {
            const response = await fetch('/playlists');
            if (response.ok) {
                const playlists = await response.json();
                displayPlaylists(playlists);
            } else {
                console.error('Failed to fetch playlists');
            }
        });

        function displayPlaylists(data) {
    const container = document.getElementById('playlist-container');
    container.innerHTML = ''; // Clear previous content
    data.items.forEach(playlist => {
        const div = document.createElement('div');
        div.textContent = playlist.name;
        div.style.cursor = 'pointer'; // Make it look clickable
        div.onclick = () => fetchArtists(playlist.id); // Fetch artists on click
        container.appendChild(div);
    });
}

async function fetchArtists(playlistId) {
    // Implement fetching artists from the server
    const response = await fetch(`/artists?playlistId=${playlistId}`);
    if (response.ok) {
        const artists = await response.json();
        // Process and display artists here
    } else {
        console.error('Failed to fetch artists');
    }
}
    </script>
</body>
</html>
